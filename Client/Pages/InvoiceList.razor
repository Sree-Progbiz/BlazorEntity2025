@page "/invoice-list"
@using BlazorEntity2025.Shared.Models
@inject HttpClient Http

<h2 style="text-align:center;">Invoice List</h2>

@if (invoices == null)
{
    <p>Loading invoices...</p>
}
else if (!invoices.Any())
{
    <p>No invoices found.</p>
}
else
{
    @foreach (var invoice in invoices)
    {
        <div style="border:1px solid #333; padding:20px; margin-bottom:30px; width:700px;">
            <!-- Header -->
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <div>
                    <h3 style="margin:0;">Invoice #: @invoice.InvoiceID</h3>
                    <p style="margin:0;">Customer: @invoice.CustomerName</p>
                </div>
                <div style="text-align:right;">
                    <p style="margin:0;">Date: @DateTime.Now.ToShortDateString()</p>
                </div>
            </div>

            <!-- Items Table -->
            <table style="width:100%; border-collapse:collapse;">
                <thead>
                    <tr style="background-color:#f2f2f2;">
                        <th style="border:1px solid #333; padding:8px; width:5%;">#</th>
                        <th style="border:1px solid #333; padding:8px; width:70%;">Item Name</th>
                        <th style="border:1px solid #333; padding:8px; width:25%; text-align:right;">Price</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < invoice.Items.Count; i++)
                    {
                        var item = invoice.Items[i];
                        <tr>
                            <td style="border:1px solid #333; padding:8px;">@(i + 1)</td>
                            <td style="border:1px solid #333; padding:8px;">@item.Name</td>
                            <td style="border:1px solid #333; padding:8px; text-align:right;">@item.Price.ToString("C")</td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="2" style="border:1px solid #333; padding:8px; text-align:right;">Subtotal:</td>
                        <td style="border:1px solid #333; padding:8px; text-align:right;">@invoice.Items.Sum(x => x.Price).ToString("C")</td>
                    </tr>
                    <tr>
                        <td colspan="2" style="border:1px solid #333; padding:8px; text-align:right;">Tax (10%):</td>
                        <td style="border:1px solid #333; padding:8px; text-align:right;">@((invoice.Items.Sum(x => x.Price) * 0.10m).ToString("C"))</td>
                    </tr>
                    <tr>
                        <td colspan="2" style="border:1px solid #333; padding:8px; text-align:right;"><strong>Total:</strong></td>
                        <td style="border:1px solid #333; padding:8px; text-align:right;"><strong>@((invoice.Items.Sum(x => x.Price) * 1.10m).ToString("C"))</strong></td>
                    </tr>
                </tfoot>
            </table>

            <!-- Footer -->
            <p style="text-align:center; font-size:12px; color:#666; margin-top:20px;">
                Generated by BlazorEntity2025 &copy; @DateTime.Now.Year
            </p>
        </div>
    }
}

@code {
    private List<Invoice>? invoices;

    protected override async Task OnInitializedAsync()
    {
        invoices = await Http.GetFromJsonAsync<List<Invoice>>("api/invoice/get-invoice");
    }
}
